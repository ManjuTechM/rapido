{% extends "rapido/master/master.html" %}
{% load static %}
{% block body_block %}
<style type="text/css">
   #city_list{
   background-color: #347ab7;
   }
   input.error{
   border-color: red;
   }
   label.error{
   color: red;
   font-weight: 300 !important;
   }
</style>
<ul class="nav nav-pills">
   <li class="active"><a data-toggle="pill" href="#menu">Vendor Trips</a></li>
   <li><a data-toggle="pill" href="#menu0">View</a></li>
   <li><a data-toggle="pill" href="#menu1">Edit</a></li>
   <li><a data-toggle="pill" href="#menu2">View Rate card</a></li>
</ul>
{% if messages %}
<ul class="messages">
   {% for message in messages %}
   <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
   {% endfor %}
</ul>
{% endif %}
<div class="tab-content" style="overflow: auto;">
  

   <div id="menu" class="tab-pane fade in active">
     
      <!-- <div class="panel panel-default">
         <div class="panel-heading" style="padding: 1px 15px;">
            <h4> Vendor Trip details of Month </h4>
         </div>
         <div class="panel-body">
         </div>
      </div> -->

      <div class="panel panel-default">
         <div class="panel-body">
            <table id="example1" class="table table-bordered table-striped">
               <thead>
                  <tr>
                     <th >Date of usage</th>
                     <th >Trip ID</th>
                     <th >Vehicle No</th>
                     <th >Vehicle Model</th>
                     <th >Chauffer Name</th>
                     <th >Chauffer Phone no</th>
                     <th >Company</th>
                     <th >Guest</th>
                     <th >status</th>
                     <th >option</th>
                  </tr>
               </thead>
               <tbody>
                  {% for b in dutyslip_list %}
                  <tr>
                     <th >{{b.booking.pickupdate}}</th>
                     <th >{{b.booking.booing_id}}</th>
                     <th >{{b.vehicle_no}}</th>
                     <th >{{b.vehicle_modelname}}</th>
                     <th >{{b.chauffeur_name}}</th>
                     <th >{{b.chauffeur_phoneno}}</th>
                     <th >{{b.chauffeur_drivinglicense}}</th>
                     <th >{{b.chauffeur_badgeno}}</th>
                     <th >{{b.booking.company}} </th>
                     <th >{{b.booking.guest}}</th>
                     <th >{{b.dutyslip.status}}</th>
                     <th ><a href="/rapido/api/get_chauffeur_vehicel__details/{{b.id}}" target="_blank">{{b.id}}.</a>{{b.chauffeur_badgeno}}</th>
                  </tr>
                  {% endfor %}
               </tbody>
            </table>
         </div>
      </div>
   </div>

   <div id="menu0" class="tab-pane fade">
      <div class="panel panel-default">
         <div class="panel-heading" style="padding: 1px 15px;">
            <h4> Vendor Details </h4>
         </div>
         <!-- /.panel-heading -->
         <div class="panel-body">
            <div class="col-md-8 col-sm-8">
               <div class="col-md-6">
                  <div class="table-responsive">
                     <table class="table">
                        <tbody>
                           <tr>
                              <td>Vendor Type : {{vendor.vendor_type}}</td>
                           </tr>
                           <tr>
                              <td>Vendor Name : {{vendor.vendor_name}}</td>
                           </tr>
                           <tr>
                              <td>Vendor Email : {{vendor.vendor_email}}</td>
                           </tr>
                           <tr>
                              <td>Vendor Phone No. : {{vendor.vendor_phoneno}} </td>
                           </tr>
                           <tr>
                              <td>Bank Name:{{vendor.bank_name}}</td>
                           </tr>
                           <tr>
                              <td>Beneficiary Name:{{vendor.beneficiary_account_name}}</td>
                           </tr>
                           <tr>
                              <td>Account Number:{{vendor.accountno}}</td>
                           </tr>
                           <tr>
                              <td>IFSC:{{vendor.ifsc}} </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
               </div>
               <div class="col-md-6">
                  <div class="table-responsive">
                     <table class="table">
                        <tbody>
                           <tr>
                              <td>Joined Date:{{vendor.vendor_joined_date}} </td>
                           </tr>
                           <tr>
                              <td>Payment type:{{ vendor.vendor_payment_type }}</td>
                           </tr>
                           <tr>
                              <td>
                                 Vendor Address:
                                 <p>street:{{vendor.vendor_address.street_address}}</p>
                                 <p>landmark:{{ vendor.vendor_address.landmark }} </p>
                                 <p>area:{{vendor.vendor_address.area}} </p>
                                 <p>city:{{vendor.vendor_address.city}}</p>
                                 <p>state:{{vendor.vendor_address.state}} </p>
                                 <p>Pincode:{{vendor.vendor_address.pincode}} </p>
                              </td>
                           </tr>
                        </tbody>
                     </table>
                  </div>
               </div>
            </div>
            <div class="col-lg-4">
               <div class="row">
                  <div class="col-md-12">
                     Vehicle and Chauffeur Details
                     <button class="btn btn-primary" data-toggle="modal" data-target="#chaufModal">Add</button>&nbsp;
                     <button class="btn btn-primary" data-toggle="modal" data-target="#vehModal">Upload</button>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div class="panel panel-default">
         <div class="panel-body">
            <table id="example1" class="table table-bordered table-striped">
               <thead>
                  <tr>
                     <th >Vehicle No</th>
                     <th >Vehicle Model</th>
                     <th >Chauffer Name</th>
                     <th >Chauffer Phone no</th>
                     <th >Driving Licence No</th>
                     <th>Badge No</th>
                     <th >status</th>
                  </tr>
               </thead>
               <tbody>
                  {% for b in chauffeur_vehicel_list %}
                  <tr>
                     <th >{{b.vehicle_no}}</th>
                     <th >{{b.vehicle_modelname}}</th>
                     <th >{{b.chauffeur_name}}</th>
                     <th >{{b.chauffeur_phoneno}}</th>
                     <th >{{b.chauffeur_drivinglicense}}</th>
                     <th >{{b.chauffeur_badgeno}}</th>
                     <th ><a href="/rapido/api/get_chauffeur_vehicel__details/{{b.id}}" target="_blank">{{b.id}}.</a>{{b.chauffeur_badgeno}}</th>
                  </tr>
                  {% endfor %}
               </tbody>
            </table>
         </div>
      </div>
   </div>
   <div id="menu1" class="tab-pane fade">
      <div class="col-lg-8">
         <div class="panel panel-default">
            <div class="panel-heading">
               Vendor-{{vendor.vendor_name}}
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
               <div class="table-responsive">
                  <table class="table">
                     <form class="form-item span8" id="item_form" method="post" action="#" 
                        enctype="multipart/form-data">
                        <!--         <form class="form-item span8" id="item_form" method="post"
                           action="/rapido/update_vendor/{{vendor.id}}/" enctype="multipart/form-data">
                           -->
                        {% csrf_token %}          
                        <table>
                           <br>
                           <tr>
                              <td>vendor type:</td>
                              <td>
                                 <select name="vendor_type" class="form-control">
                                    <option value={{vendor.vendor_type.id}} selected >{{vendor.vendor_type}}</option>
                                    <option value="Dedicated">Dedicated vender</option>
                                    <option value="Oncall">oncall vender</option>
                                    <option value="Rapido">Rapido</option>
                                 </select>
                              </td>
                           </tr>
                           <tr>
                              <td>vendor Name:</td>
                              <td><input type="text" class="form-control" name="vendor_name"  value="{{vendor.vendor_name}}"></td>
                           </tr>
                           <tr>
                              <td>vendor joined date:</td>
                              <td><input type="text" id="join_date" class="form-control" name="vendor_joined_date"  value={{vendor.vendor_joined_date|date:'d/m/Y' }}>{{vendor.vendor_joined_date}}</td>
                           </tr>
                           <tr>
                              <td>vendor phoneno:</td>
                              <td><input type="text" class="form-control" name="vendor_phoneno" pattern="[0-9]{10}" maxlength="10" min="7000000000" max="9999999999" value={{vendor.vendor_phoneno}}></td>
                           </tr>
                           <tr>
                              <td>vendor Email-Id:</td>
                              <td><input type="email" class="form-control" name="vendor_email" value={{vendor.vendor_email}}></td>
                           </tr>
                           <tr>
                              <td rowspan="3">Address</td>
                              <td>street name/no:<input type="text" class="form-control" name="street_address" value={{vendor.vendor_address.street_address}}></td>
                              <td>landmark:<input type="text" class="form-control" name="landmark" value={{vendor.vendor_address.landmark}}></td>
                           </tr>
                           <tr>
                              <td>area:<input type="text" class="form-control"  name="area" value={{vendor.vendor_address.area}}> </td>
                              <td>city:<input type="text" class="form-control"  name="city" value={{vendor.vendor_address.city}}></td>
                           </tr>
                           <tr>
                              <td>state:<input type="text" class="form-control" name="state" value={{vendor.vendor_address.state}} ></td>
                              <td>Pin code:<input type="text" class="form-control" name="pincode" pattern="[0-9]{6}" value={{vendor.vendor_address.pincode}}></td>
                              <td>Country:<input type="text" class="form-control" name="country" value={{vendor.vendor_address.country}}></td>
                           </tr>
                           <tr>
                              <td>vendor agreement start Date</td>
                              <td><input type="text" id="start_date" class="form-control" name="vendor_agreement_start_date">{{vendor.vendor_agreement_start_date}}</td>
                           </tr>
                           <tr>
                              <td>Vendor agreement end Date:</td>
                              <td> <input type="text" id="end_date" class="form-control" name="vendor_agreement_end_date">{{vendor.vendor_agreement_end_date}}</td>
                           </tr>
                           <tr>
                              <td>vendor payment type:</td>
                              <td><input type="text" class="form-control" name="vendor_payment_type" value={{vendor.vendor_payment_type}}></td>
                           </tr>
                           <tr>
                              <td>upload new Documents:</td>
                              <!-- by giving the name of documts in jinja notation gives error  so not added its value-->
                              <td><input type="file" name="vendor_documents" value=""></td>
                           </tr>
                           <tr>
                              <td>Change picture:</td>
                              <!-- by giving the image url in jinja notation gives error  so not added its value-->
                              <td><input type="file" name="vendor_picture" value=""></td>
                           </tr>
                           <tr>
                              <td>Bank Name:</td>
                              <td><input type="text" class="form-control" name="bank_name" value={{vendor.bank_name}}></td>
                           </tr>
                           <tr>
                              <td>Beneficiary Account Name:</td>
                              <td><input type="text" class="form-control" name="beneficiary_account_name" value={{vendor.beneficiary_account_name}}></td>
                           </tr>
                           <tr>
                              <td>Account Number:</td>
                              <td><input type="text" class="form-control" name="accountno"  value={{vendor.accountno}}></td>
                           </tr>
                           <tr>
                              <td>IFSC:</td>
                              <td><input type="text" class="form-control" name="ifsc"  value={{vendor.ifsc}}></td>
                           </tr>
                        </table>
                        <!-- Provide a button to click to submit the form. -->
                        <div class="modal-footer">
                           <div class="form-group">
                              <div class="col-xs-offset-3 col-xs-5">
                                 <input class="btn btn-success" type="submit" value="Save">
                                 <input type="reset" class="btn btn-primary" value="Reset">
                              </div>
                           </div>
                        </div>
                     </form>
                  </table>
                  <!-- /.table-responsive -->
               </div>
            </div>
            <!-- /.panel-body -->
         </div>
      </div>
   </div>
   <!-- /.tab-pane -->
   <div class="tab-pane" id="menu2">
      <div class="panel panel-primary">
         <div class="panel-heading">
            <h4>
               Select city:
               <select id="city_list" name="category">
                  {% for c in city_list %}
                  <option value={{c.id}}>{{c.name}}</option>
                  {% endfor %}
               </select>
               &nbsp;
               <input type="text" id="vendor_gst" style="color: black;" placeholder="Enter GST no. (optional)" name="vendorGst">
            </h4>
         </div>
      </div>
      <div class="nav-tabs-custom">
         <ul class="nav nav-tabs">
            <li class="active"><a href="#tab_1" data-toggle="tab">Airport Transfers</a></li>
            <li><a href="#tab_2" data-toggle="tab">Out station</a></li>
            <li><a href="#tab_3" data-toggle="tab">City Usage</a></li>
         </ul>
         <div class="tab-content">
            <div class="tab-pane active" id="tab_1">
               <div class="panel panel-default">
                  <div class="panel-heading" style="padding: 1px 15px;">
                     <h4>
                        Airport Transfers
                        <span class="pull-right">
                           From city:
                           <select id="afromcity_id" name="fromcity">
                              {% for fc in city_list %}
                              <option value={{fc.id}}>{{fc.name}}</option>
                              {% endfor %}
                           </select>
                           &nbsp;
                           To city:
                           <select id="atocity_id" name="tocity">
                              {% for tc in city_list %}
                              <option value={{tc.id}}>{{tc.name}}</option>
                              {% endfor %}
                           </select>
                           &nbsp; =
                           <button id="airportCopy"> copy airport ratecard </button>
                        </span>
                     </h4>
                  </div>
                  <!-- /.panel-heading -->
                  <div class="panel-body">
                     <div class="table-responsive">
                        <table class="table">
                           <thead>
                              <tr>
                                 <th>Category</th>
                                 <th>
                                    Select service type :
                                    <select id="select_service1" class="form-control" name="service_type">
                                       {% for servicetype in travelservice_type_list %}
                                       <option class="form-control" value={{servicetype.id}}>{{servicetype.name}}</option>
                                       {% endfor %}
                                    </select>
                                 </th>
                                 <th>Vehicle Varient</th>
                                 <th>slab</th>
                                 <th>Margin</th>
                                 <th>Base Fare</th>
                                 <th></th>
                                 <th></th>
                              </tr>
                           </thead>
                           <tbody>
                              {% for c in cat_list %}
                              <tr class="forInput">
                                 <td><span class="cat_id">{{c.id}}</span>.{{c.name}}</td>
                                 <td class="ast"></td>
                                 <td class="vvid_result1"><input type="text" class="vvid atags" name=""></td>
                                 <td>Airport</td>
                                 <td><input type="text" name="margin" class="airportMargin form-control" /></td>
                                 <td><input type="text" class="base_rate form-control" name="base_rate"/></td>
                                 <td><button class="airport_editid btn btn-success">Edit</button></td>
                                 <td><button class="airport_saveid btn btn-primary" disabled>save</button></td>
                              </tr>
                              {% endfor %}
                           </tbody>
                        </table>
                     </div>
                     <!-- <a  data-toggle="modal" data-target="#myModal1">Add price for new category</a> -->
                     <button id="saveairport" class="center-block btn btn-success">Save</button>
                  </div>
               </div>
            </div>
            <!-- /.tab-pane -->
            <div class="tab-pane" id="tab_2">
               <div class="panel panel-default">
                  <div class="panel-heading" style="padding: 1px 15px;">
                     <h4>
                        Out station
                        <span class="pull-right">
                           From city:
                           <select id="ofromcity_id" name="fromcity">
                              {% for fc in city_list %}
                              <option value={{fc.id}}>{{fc.name}}</option>
                              {% endfor %}
                           </select>
                           &nbsp;
                           To city:
                           <select id="otocity_id" name="tocity">
                              {% for tc in city_list %}
                              <option value={{tc.id}}>{{tc.name}}</option>
                              {% endfor %}
                           </select>
                           &nbsp; =
                           <button id="outstationCopy"> copy Outstation ratecard </button>
                        </span>
                     </h4>
                  </div>
                  <!-- /.panel-heading -->
                  <div class="panel-body">
                     <div class="table-responsive">
                        <table class="table">
                           <thead>
                              <tr>
                                 <th>Category</th>
                                 <th>
                                    Select service type :
                                    <select id="select_service2" class="form-control" name="service_type">
                                       {% for servicetype in travelservice_type_list %}
                                       <option value={{servicetype.id}}>{{servicetype.name}}</option>
                                       {% endfor %}
                                    </select>
                                 </th>
                                 <th>Vehicle Varient</th>
                                 <th>Margin</th>
                                 <th>Min Km/Day </th>
                                 <th>Per Km </th>
                                 <th>Extra Km</th>
                                 <th>day batta</th>
                                 <th>night batta</th>
                                 <th></th>
                                 <th></th>
                              </tr>
                           </thead>
                           <tbody>
                              {% for c in cat_list %}
                              <tr>
                                 <td><span class="cat_id1">{{c.id}}</span>.{{c.name}}</td>
                                 <td class="ost"></td>
                                 <td class="vvid_result2"> <input type="text" class="vvid_ots otags" name="">   
                                 </td>
                                 <td><input type="text" class="outstationMargin form-control" name="margin"></td>
                                 <td><input type="text" class="minkm form-control" name=""/></td>
                                 <td><input type="text" class="perkm form-control" name="base_rate"/></td>
                                 <td><input type="text" class="extrakm form-control" name="base_rate"/></td>
                                 <td><input type="text" class="day_bata form-control" name="base_rate"/></td>
                                 <td><input type="text" class="night_bata form-control" name="base_rate"/></td>
                                 <td><button class="outstation_editid btn btn-success">Edit</button></td>
                                 <td><button class="outstation_saveid btn btn-primary" disabled>Save</button></td>
                              </tr>
                              {% endfor %}
                           </tbody>
                        </table>
                     </div>
                     <!--           <a  data-toggle="modal" data-target="#myModal2">Add price for new category</a> -->
                     <br/><button id="saveoutstation" class="center-block btn btn-success">Save</button>
                  </div>
               </div>
            </div>
            <!-- /.tab-pane -->
            <div class="tab-pane" id="tab_3">
               <div class="panel panel-default">
                  <div class="panel-heading" style="padding: 1px 15px;">
                     <h4>
                        Disposal
                        <span>select slab:</span><br/>
                        <select id="slab" multiple>
                           {% for s in slab_list %}
                           <option id=slab{{s.id}} value={{s.id}}>{{s.name}}</option>
                           {% endfor %}
                        </select>
                        <span class="pull-right">
                           From city:
                           <select id="cfromcity_id" name="fromcity">
                              {% for fc in city_list %}
                              <option value={{fc.id}}>{{fc.name}}</option>
                              {% endfor %}
                           </select>
                           &nbsp;
                           To city:
                           <select id="ctocity_id" name="tocity">
                              {% for tc in city_list %}
                              <option value={{tc.id}}>{{tc.name}}</option>
                              {% endfor %}
                           </select>
                           &nbsp; =
                           <button id="cityCopy"> copy city ratecard </button>
                        </span>
                     </h4>
                  </div>
                  <!-- /.panel-heading -->
                  <div class="panel-body">
                     <div class="table-responsive">
                        <table class="table">
                           <thead>
                              <tr id="thcount">
                                 <th>Category</th>
                                 <th>
                                    Select service type :
                                    <select id="select_service3" class="form-control" name="service_type">
                                       {% for servicetype in travelservice_type_list %}
                                       <option value={{servicetype.id}}>{{servicetype.name}}</option>
                                       {% endfor %}
                                    </select>
                                 </th>
                                 <th>Vehicle Varient</th>
                                 <th>Margin</th>
                                 <th class="addSlab" style="display: none;"></th>
                                 <th> Extra Km </th>
                                 <th> Extra Hrs</th>
                                 <th>FGR</th>
                                 <th>Night Bhatta</th>
                                 <th></th>
                                 <th></th>
                              </tr>
                           </thead>
                           <tbody>
                              {% for r in cat_list %}
                              <tr id="trcount">
                                 <td>{{r.name}}</td>
                                 <td class="cst"></td>
                                 <td class="vvid_result3"> <input type="text" class="vvid_city ctags" name="">
                                 <td><input type="text" class="cityMargin form-control" name="margin"></td>
                                 <td class="slab_data" style="display: none;"></td>
                                 <td><input class="city_extra_km form-control" type="text" name="extrakm"></td>
                                 <td><input class="city_extra_hrs form-control" type="text" name="extrahrs"></td>
                                 <td><input class="fgr form-control" value="0" type="text" name="fgr"></td>
                                 <td><input class="city_nightbatta form-control" type="text" name="nightbatta"></td>
                                 <td><button class="city_editid btn btn-success">Edit</button></td>
                                 <td><button class="city_saveid btn btn-primary" disabled>Save</button></td>
                              </tr>
                              {% endfor %}
                           </tbody>
                        </table>
                     </div>
                     <!-- <a  data-toggle="modal" data-target="#myModal3">Add price for new category</a> --><br/>
                     <button id="savecityusage" class="center-block btn btn-success">Save</button>
                  </div>
               </div>
            </div>
         </div>
         <!-- /.tab-pane -->
      </div>
      <!-- /.tab-pane -->
   </div>
</div>
<div class="modal fade" id="chaufModal" role="dialog">
   <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
         <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Add Chauffeur and Vehicle details</h4>
         </div>
         <form id="adddetails">
            <div class="modal-body">
               <input placeholder="Chauffeur Name" id="chauffeur_name" class="form-control" name="chauffeur_name" required/><br/>
               <input placeholder="Chauffeur phoneno" id="chauffeur_phoneno" class="form-control" name="chauffeur_phoneno" maxlength="10" minlength="10" pattern="[0-9]{10}" data-msg="please enter 10 digit mobile number" required/><br/>
               <input placeholder="Vehicle Color" id="vehicle_colour" class="form-control" name="vehicle_colour" required/><br/>
               <input placeholder="Vehicle No." id="vehicle_no" class="form-control" name="vehicle_no" required/><br/>
               <input placeholder="Vehicle Model Name" id="vehicle_modelname" class="form-control" name="vehicle_modelname" required/><br/>
               <input placeholder="Chauffeur DL No." id="chauffeur_drivinglicense" class="form-control" name="chauffeur_drivinglicense" required/><br/>
               <input placeholder="Chauffeur Badge No." id="chauffeur_badgeno" class="form-control" name="chauffeur_badgeno" required/><br/>
               <input placeholder="Chauffeur Address" id="chauffeur_address" class="form-control" name="chauffeur_address" required/><br/>
               <input placeholder="Seating capacity" type="number" value="4" id="seat_capacity" class="form-control" name="chauffeur_address" required/><br/>
            </div>
            <div class="modal-footer">
               <button type="button" id="AddVC" class="btn btn-success">Add</button>
               <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            </div>
         </form>
      </div>
   </div>
</div>

<div class="modal fade" id="vehModal" role="dialog">
   <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
         <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Upload Vehicle and chauffeur details</h4>
         </div>
         <div class="modal-body">
            <form class="form-horizontal no-margin" action="/rapido/add_chauffeur_vehicel/{{vendor.id}}/" method="POST"   enctype="multipart/form-data">
               {% if context_dict %}
               <h3> {{ context_dict.message }}</h3>
               {% endif %}
               {% csrf_token %}                                                  
               <div class="form-group">
                  <label class="col-sm-2 control-label">Select File:</label>
                  <div class="col-xs-6">
                     <input  type="file" required="" name="filename">
                  </div>
               </div>
               <div class="form-group">
                  <div class="col-sm-offset-2 col-sm-10">
                     <button type="submit" class="btn btn-info">Upload</button>
                  </div>
               </div>
            </form>
         </div>
      </div>
   </div>
</div>
{% endblock %}



{% block javascript %}

<script type="text/javascript">

   $(function()
   {
     $('#example1').DataTable({
       dom: "<'row'<'col-sm-3'l><'col-sm-3'f><'col-sm-3 toolbar'><'col-sm-3'p>>" +
       "<'row'<'col-sm-12'tr>>" +
       "<'row'<'col-sm-5'i><'col-sm-7'p>>",
       });
   
      setDatePicker("#join_date");
      setDatePicker("#start_date");
      setDatePicker("#end_date");
   
      function setDatePicker(date1){
   
      $(date1).datepicker({ 
        dateFormat: 'dd/mm/yy'
         });
   
      }
   
      $("#vendor_form").validate({
        messages:{
          vendor_phoneno:getMsg("#vendor_phoneno")
        }
      });
   
      function getMsg(selector){
        return $(selector).attr('data-msg');
      }
   
   
      //add booker details
     $("#AddVC").click(function(){
     
     
        $("#adddetails").validate({
          messages:{
           chauffeur_phoneno:getMsg("#chauffeur_phoneno")
          }
        });
     
          if($("#adddetails").valid()){
      var chauffeurVehicleDetails = {
     "vehicle_no": $("#vehicle_no").val(),
     "vehicle_modelname":$("#vehicle_modelname").val(),
     "vehicle_colour": $("#vehicle_colour").val(),
     "chauffeur_name": $("#chauffeur_name").val(),
     "chauffeur_phoneno": $("#chauffeur_phoneno").val(),
     "chauffeur_drivinglicense": $("#chauffeur_drivinglicense").val(),
     "chauffeur_badgeno": $("#chauffeur_badgeno").val(),
     "chauffeur_address": $("#chauffeur_address").val(),
     "seat_capacity":$("#seat_capacity").val(),
     "vendor":{{vendor.id}},
     "created_by":{{user.id}}
     };
     console.log(chauffeurVehicleDetails);
     $.ajax({            //send json-object to api and read response
              url: '/rapido/api/get_chauffeur_vehicel_list/',
              method: "POST",
              headers: {
                  'X-CSRFToken': '{{ csrf_token }}'
              },
              contentType: 'application/json',
              data:JSON.stringify(chauffeurVehicleDetails),
              success: function(res) {
                  swal({
                    title:"Vehicle and chauffeur details added successfully",
                    icon:"success"
                  });
              }
          });
     }
     });
  });

// ============ Rate Card Related script ==========================

  //standard rate_card airport related
   var vv_json = [
   {% for i in vehicle_model %}
   { "id": {{i.id}},
   "label":"{{i.name}}"
   },
   
   {% endfor %}
   ];   
   
   var cat_id = document.getElementsByClassName("cat_id");
   
   var cat_id1 = document.getElementsByClassName("cat_id1");
   var minkm = document.getElementsByClassName("minkm");
   var perkm = document.getElementsByClassName("perkm");
   var extrakm = document.getElementsByClassName("extrakm");
   var day_bata = document.getElementsByClassName("day_bata");
   var night_bata = document.getElementsByClassName("night_bata");
   var base_rate = document.getElementsByClassName("base_rate");
   var ast = document.getElementsByClassName("ast");
   var ost = document.getElementsByClassName("ost");
   var cst = document.getElementsByClassName("cst");
   var city_extra_km = document.getElementsByClassName("city_extra_km");
   var city_nightbatta = document.getElementsByClassName("city_nightbatta");
   var city_extra_hrs = document.getElementsByClassName("city_extra_hrs");
   var vv_airname = document.getElementsByClassName("atags");
   var vv_otsname = document.getElementsByClassName("otags");
   var vv_cityname = document.getElementsByClassName("ctags");
   var token = '{{ csrf_token }}';
   var airportEditId = document.getElementsByClassName("airport_editid");
   var airportSaveId = document.getElementsByClassName("airport_saveid");
   var outstationEditId = document.getElementsByClassName("outstation_editid");
   var outstationSaveId = document.getElementsByClassName("outstation_saveid");    
   var vendor_gstno= document.getElementById("vendor_gst");
   var cityEditId = document.getElementsByClassName("city_editid");
   var citySaveId = document.getElementsByClassName("city_saveid");
   var newEvent;
   var airportMargin = document.getElementsByClassName("airportMargin");
   var outstationMargin = document.getElementsByClassName("outstationMargin");
   var cityMargin = document.getElementsByClassName("cityMargin");
    tagsLoad();        
   function tagsLoad(){
         $(function(){
      $('.vvid').tagsInput({width:'100%',defaultText:'Domain', autocomplete_url:vv_json});
      $('.vvid_ots').tagsInput({width:'100%',defaultText:'Domain', autocomplete_url:vv_json});
      $('.vvid_city').tagsInput({width:'100%',defaultText:'Domain', autocomplete_url:vv_json});
    });
   }
   
   $('#city_list').on('click', function() {
    var cityid = $('#city_list option:selected').val();
   
    $.getJSON('/rapido/api/vendorairportratecardbycity/{{vendor.id}}/' + cityid, function(data) {
   
      //gst value get
   
        if(data.length==0){           //check whether city has an empty array?
          vendor_gstno.value = ""; 
        }
   
      $.each(data, function(key, value) {
        if(value.gst_no==null||value.gst_no==""){     //check whether gst value was entered
          vendor_gstno.value = "";
        }
        else{
          vendor_gstno.value = value.gst_no;       //check whether gst value is present
        }
      });
   
      //gst value get ends
   
        for (var i = 0; i < cat_id.length; i++) {
            var j = false;
   
            var airport;
            // if(data.length==0){
            //   base_rate[i].value = "";
            // }
   
            function editCall(value){
                    //edit
                          $('.fireevent'+value).on('click',function(){
                            $(this).attr("id",value);
                            $(this).parents("tr").find("input.base_rate").prop('disabled',false);
                            $(this).parents("tr").find("input.airportMargin").prop('disabled',false);
                            $(this).parents("tr").find("input.atags").addClass("vvid");
                            tagsLoad();
                            $(this).attr("disabled",true);
                            $('.smokeevent'+value).removeAttr("disabled");
                            // $(this).text("save");
                            // $(this).removeClass().addClass("smokeevent"+value).addClass("btn btn-primary");
                            saveCall(value);
                        });
   
            };
   
            function saveCall(value){
   
                  var smokeEvt = ".smokeevent"+value;
                          $(smokeEvt).on('click',function(){
                               airport = {
                                  "updated_by":{{user.id}},
                                  "city":parseInt($('#city_list option:selected').val()),
                                  "service_type":parseInt($('#select_service1 option:selected').val()),
                                  "base_rate":parseInt($(this).parents("tr").find("input.base_rate").val()),
                                  "vehicle_varient":$(this).parents("tr").find("input.atags").val(),
                                  "vendor":{{vendor.id}},
                                  "margin":parseInt($(this).parents("tr").find("input.airportMargin").val()),
                               };
                               AjaxCall(value,smokeEvt);
                            //save 
                          });
                        };
   
            function AjaxCall(value,event){
   
                            $.ajax({
                                url: '/rapido/api/update_vendorairportratecard/'+value+'/',
                                method: 'PUT',
                                headers:{'X-CSRFToken':'{{ csrf_token }}'},                  
                                contentType : 'application/json',
                                context:this,
                                data: JSON.stringify(airport),
                                success:function(res){
                                  $(event).parents("tr").find("input.base_rate").prop('disabled',true);
                                  $(event).parents("tr").find("input.airportMargin").prop('disabled',true);
                                  $(event).parents("tr").find("input.vvid").removeClass("vvid");
                                  $(event).parents("tr").find("div.tagsinput").remove();
                                  $(event).parents("tr").find("input.atags").css("display","block");
                                  $(event).attr("disabled",true);
                                  $('.fireevent'+value).removeAttr("disabled");
                                  // saveCall(value);
                                }
                             });
   
            };
   
            $.each(data, function(key, value) {
                if (parseInt(cat_id[i].innerHTML) == value.category.id) {
                    base_rate[i].value = value.base_rate;
                    ast[i].innerHTML = value.service_type.name;
                    airportMargin[i].value = value.margin;
                    if(value.vehicle_varient==null || value.vehicle_varient==""){
                    document.getElementsByClassName("vvid_result1")[i].innerHTML = "<input type='text' class='vvid atags' name=''>";
                    }
                    else
                    {
                    document.getElementsByClassName("vvid_result1")[i].innerHTML = "<input type='text' class='atags' style='border:none;' value='"+value.vehicle_varient+"' name='' readonly>";
   
                    }
                    airportEditId[i].setAttribute("id",value.id);
                    airportEditId[i].classList.add("fireevent"+value.id);
                    newEvent = value.id;
                    airportSaveId[i].classList.add("smokeevent"+value.id);
                    base_rate[i].setAttribute("disabled",true);
                    airportMargin[i].setAttribute("disabled",true);
                    editCall(newEvent);
                    j = true;
                }
   
            });
            if (j == false) {
                base_rate[i].value = "";
                ast[i].innerHTML = "";
                airportMargin[i].value = "";
                base_rate[i].disabled = false;
                airportMargin[i].disabled = false;
                document.getElementsByClassName("vvid_result1")[i].innerHTML = "<input type='text' class='vvid atags' name=''>";
            }
   
        }
        tagsLoad();
    });
   
    $.getJSON('/rapido/api/vendoroutstationratecardbycity/{{vendor.id}}/' + cityid, function(data) {
   
   
      //gst value get
   
        if(data.length==0){           //check whether city has an empty array?
          vendor_gstno.value = ""; 
        }
   
      $.each(data, function(key, value) {
        if(value.gst_no==null||value.gst_no==""){     //check whether gst value was entered
          vendor_gstno.value = "";
        }
        else{
          vendor_gstno.value = value.gst_no;       //check whether gst value is present
        }
      });
   
      //gst value get ends
   
        for (var i = 0; i < cat_id.length; i++) {
            var j = false;
            var outstation;
   
            function editCall(value){
                    //edit
                          $('.fireevent'+value).on('click',function(){
                            $(this).attr("id",value);
                            $(this).parents("tr").find("input.outstationMargin").prop('disabled',false);
                            $(this).parents("tr").find("input.minkm").prop('disabled',false);
                            $(this).parents("tr").find("input.perkm").prop('disabled',false);
                            $(this).parents("tr").find("input.extrakm").prop('disabled',false);
                            $(this).parents("tr").find("input.day_bata").prop('disabled',false);
                            $(this).parents("tr").find("input.night_bata").prop('disabled',false);
                            $(this).parents("tr").find("input.otags").addClass("vvid_ots");
   
                            $(this).attr("disabled",true);
                            $('.smokeevent'+value).removeAttr("disabled");
                            tagsLoad();
   
                            saveCall(value);
                  //save 
                        });
   
            };
   
            function saveCall(value){
   
                  var smokeEvt = ".smokeevent"+value;
                          $(smokeEvt).on('click',function(){
                               outstation = {
               "min_km": parseInt($(this).parents("tr").find("input.minkm").val()),
               "perkm_rate": parseFloat($(this).parents("tr").find("input.perkm").val()),
               "extrakm_rate": parseFloat($(this).parents("tr").find("input.extrakm").val()),
               "day_batta": parseInt($(this).parents("tr").find("input.day_bata").val()),
               "night_batta": parseInt($(this).parents("tr").find("input.night_bata").val()),
               "updated_by": {{user.id}},
               "city":parseInt($('#city_list option:selected').val()),
               "vendor":{{vendor.id}},
               "service_type":parseInt($('#select_service2 option:selected').val()),
               "vehicle_varient":$(this).parents("tr").find("input.otags").val(),
               "margin": parseFloat($(this).parents("tr").find("input.outstationMargin").val())
   
               };
   
              AjaxCall(value,smokeEvt);
              });
          };
   
            function AjaxCall(value,event){
   
                            $.ajax({
                                url: '/rapido/api/update_vendoroutstationratecard/'+value+'/',
                                method: 'PUT',
                                headers:{'X-CSRFToken':'{{ csrf_token }}'},                  
                                contentType : 'application/json',
                                context:this,
                                data: JSON.stringify(outstation),
                                success:function(res){
                                  $(event).parents("tr").find("input.minkm").prop('disabled',true);
                                  $(event).parents("tr").find("input.outstationMargin").prop('disabled',true);
                                  $(event).parents("tr").find("input.perkm").prop('disabled',true);
                                  $(event).parents("tr").find("input.extrakm").prop('disabled',true);
                                  $(event).parents("tr").find("input.day_bata").prop('disabled',true);
                                  $(event).parents("tr").find("input.night_bata").prop('disabled',true);
   
                                  $(event).parents("tr").find("input.otags").removeClass("vvid_ots");
                                  $(event).parents("tr").find("div.tagsinput").remove();
                                  $(event).parents("tr").find("input.otags").css("display","block");
                                  $(event).attr("disabled",true);
                                  $('.fireevent'+value).removeAttr("disabled");
                                }
                             });
   
            };
   
            $.each(data, function(key, value) {
                if (parseInt(cat_id1[i].innerHTML) == value.category.id) {
                    minkm[i].value = value.min_km;
                    perkm[i].value = value.perkm_rate;
                    extrakm[i].value = value.extrakm_rate;
                    day_bata[i].value = value.day_batta;
                    outstationMargin[i].value = value.margin;
                    night_bata[i].value = value.night_batta;
                    ost[i].innerHTML = value.service_type.name;
                    if(value.vehicle_varient==null || value.vehicle_varient=="")
                    {
                    document.getElementsByClassName("vvid_result2")[i].innerHTML = "<input type='text' class='vvid_ots otags' name=''>";
                    }
   
                  else{ 
                    document.getElementsByClassName("vvid_result2")[i].innerHTML = "<input type='text' class='otags' style='border:none;' value='"+value.vehicle_varient+"' name='' readonly>";
                  }
                    outstationEditId[i].classList.add("fireevent"+value.id);
                    outstationSaveId[i].classList.add("smokeevent"+value.id);
                    outstationEditId[i].setAttribute("id",value.id);
                    outstationMargin[i].setAttribute("disabled",true);
                    minkm[i].setAttribute("disabled",true);
                    perkm[i].setAttribute("disabled",true);
                    extrakm[i].setAttribute("disabled",true);
                    day_bata[i].setAttribute("disabled",true);
                    night_bata[i].setAttribute("disabled",true);
                    editCall(value.id);
                    j = true;
                }
   
            });
            if (j == false) {
                minkm[i].value = "";
                perkm[i].value = "";
                extrakm[i].value = "";
                day_bata[i].value = "";
                night_bata[i].value = "";
                ost[i].innerHTML = "";
                outstationMargin[i].value = "";
                outstationMargin[i].disabled = false;
                minkm[i].disabled = false;
                perkm[i].disabled = false;
                extrakm[i].disabled = false;
                day_bata[i].disabled = false;
                night_bata[i].disabled = false;
                document.getElementsByClassName("vvid_result2")[i].innerHTML = "<input type='text' class='vvid_ots otags' name=''>";
            }
   
        }
        tagsLoad();
    });
   
   
    $.getJSON('/rapido/api/vendorcityratecardbycity/{{vendor.id}}/' + cityid, function(data) {
   
   
      //gst value get
   
        if(data.length==0){           //check whether city has an empty array?
          vendor_gstno.value = ""; 
        }
   
      $.each(data, function(key, value) {
        if(value.gst_no==null||value.gst_no==""){     //check whether gst value was entered
          vendor_gstno.value = "";
        }
        else{
          vendor_gstno.value = value.gst_no;       //check whether gst value is present
        }
      });
   
      //gst value get ends
   
   //remove columns of slabs if exists
   var optioncount=0;
    $('#slab option').each(function() {
        optioncount++;
    });
   
    var spans = document.querySelectorAll('#thcount th');
   
    var colCount = 0;
   
    //count no. of columns in cityusage
    $('#thcount th').each(function() {
        colCount++;
    });
    //count no. of columns in cityusage end
   
    //avoid adding duplicate slabs
    var thpresent = false;
    for(var a=0;a<optioncount;a++)
     {
        var sample = document.querySelectorAll('#slab option');
        var slab_id = sample[a].value;
   
            for (var k = 0; k < colCount; k++) {
              // console.log(spans[k].className);
                if (('slab'+slab_id) == spans[k].className) {
                    $('.slab'+slab_id).remove();
                    $('.slab_dat'+slab_id).remove();
                    // console.log("remove");
                }
            }
   
     } 
   
    if (thpresent == false) {
        $('.close').click(function() {
            $(this).parent().remove();
            $('.slab_dat').remove();
        });
    } else {
   
        alert("slab already added");
    }
    //avoid adding duplicate slabs end
   
   //remove columns of slabs if exists end    
   
    //count no. of columns in cityusage
   var unique_slabs = [];
            $.each(data, function(key, value) 
            {
                if ($.inArray(value.slab.id, unique_slabs) > -1)
                {
                    // console.log("There's a match!");
                }
                                
                else 
                {
                    unique_slabs.push(value.slab.id, value.slab.name);
   
                }
            });
   
   
                for (var n = 0; n <= (unique_slabs.length - 1); n += 2) 
                {
   
                    var text2 = $("<th class='slab" + unique_slabs[n] + "'>" + unique_slabs[n + 1] + "</th>");
                    var text3 = $("<td class='slab_dat" + unique_slabs[n] + "'><input class='slabdata" + unique_slabs[n] + " " + "form-control' type='text'></td>");
   
                    $('.addSlab').last().before(text2);
                    $('.slab_data').before(text3);
                }            
   
        for (var i = 0; i < cat_id.length; i++) 
        {
            var j = false;
            var cityusage;
   
            function editCall(value,slab){
                    //edit
              $('.fireevent'+value).on('click',function(){
                $(this).attr("id",value);
                $(this).parents("tr").find("input.slabdata"+slab).prop('disabled',false);
                $(this).parents("tr").find("input.city_extra_km").prop('disabled',false);
                $(this).parents("tr").find("input.city_extra_hrs").prop('disabled',false);
                $(this).parents("tr").find("input.fgr").prop('disabled',false);
                $(this).parents("tr").find("input.city_nightbatta").prop('disabled',false);
                $(this).parents("tr").find("input.cityMargin").prop('disabled',false);
                $(this).parents("tr").find("input.ctags").addClass("vvid_city");
   
                tagsLoad();
                $(this).attr("disabled",true);
                $('.smokeevent'+value).removeAttr("disabled");
                saveCall(value,slab);
                //save 
              });
   
            };
   
            function saveCall(value,slab){
              var smokeEvt = ".smokeevent"+value;
              $(smokeEvt).on('click',function(){
                // console.log($(this).parents("tr").find("input.slabdata").val());
                cityusage = {
                  "bill_computationtype": "a",
                  "fgr":parseInt($(this).parents("tr").find("input.fgr").val()),
                  "base_rate":parseInt($(this).parents("tr").find("input.slabdata"+slab).val()),
                  "extra_kmrate":parseFloat($(this).parents("tr").find("input.city_extra_km").val()),
                  "extra_hrrate":parseInt($(this).parents("tr").find("input.city_extra_hrs").val()),
                  "night_batta":parseInt($(this).parents("tr").find("input.city_nightbatta").val()),
                  "updated_by": {{user.id}},
                  "vendor":{{vendor.id}},    
                  "city": parseInt($('#city_list option:selected').val()),
                  "service_type": parseInt($('#select_service3 option:selected').val()),
                  "slab": parseInt(slab),
                  "vehicle_varient":$(this).parents("tr").find("input.ctags").val(),
                  "margin":parseFloat($(this).parents("tr").find("input.cityMargin").val())
                };
   
                console.log(cityusage);
   
                AjaxCall(value,slab,smokeEvt);
   
              });
            };
   
            function AjaxCall(value, slab, event) {
                $.ajax({
                    url: '/rapido/api/update_vendorcityratecard/' + value + '/',
                    method: 'PUT',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    contentType: 'application/json',
                    context: this,
                    data: JSON.stringify(cityusage),
                    success: function(res) {
   
                        $(event).parents("tr").find("input.slabdata" + slab).prop('disabled', true);
                        $(event).parents("tr").find("input.city_extra_km").prop('disabled', true);
                        $(event).parents("tr").find("input.city_extra_hrs").prop('disabled', true);
                        $(event).parents("tr").find("input.city_nightbatta").prop('disabled', true);
                        $(event).parents("tr").find("input.cityMargin").prop('disabled', true);
                        $(event).parents("tr").find("input.fgr").prop('disabled', true);
                        $(event).parents("tr").find("input.ctags").removeClass("vvid_city");
                        $(event).parents("tr").find("div.tagsinput").remove();
                        $(event).parents("tr").find("input.ctags").css("display", "block");
                        
                        $(event).attr("disabled",true);
                        $('.fireevent'+value).removeAttr("disabled");
                    }
                });
            };
   
            $.each(data, function(key, value) 
            {
                if(parseInt(cat_id1[i].innerHTML)==value.category.id)
                {
                   //display value
                   city_extra_km[i].value = value.extra_kmrate;
                   city_extra_hrs[i].value = value.extra_hrrate;
                   city_nightbatta[i].value = value.night_batta;
                   cityMargin[i].value = value.margin;
                   cst[i].innerHTML = value.service_type.name;
                   document.getElementsByClassName("slabdata"+value.slab.id)[i].value = value.base_rate;
                   document.getElementsByClassName("fgr")[i].value = value.fgr;
                  
                   //disabled if value
                   city_extra_km[i].disabled=true;
                   city_extra_hrs[i].disabled=true;
                   city_nightbatta[i].disabled=true;
                   cityMargin[i].disabled=true;
                   document.getElementsByClassName("fgr")[i].disabled=true;
                   document.getElementsByClassName("slabdata"+value.slab.id)[i].disabled = true;
   
                   //display vehicle varient value
                   if(value.vehicle_varient==null || value.vehicle_varient==""){
   
                    document.getElementsByClassName("vvid_result3")[i].innerHTML = "<input type='text' class='vvid_city ctags' name=''>";
                   }
   
                   else{ 
                    document.getElementsByClassName("vvid_result3")[i].innerHTML = "<input type='text' class='ctags' style='border:none;' value='"+value.vehicle_varient+"' name='' readonly>";
                   }
   
                   //for edit purpose
                   cityEditId[i].setAttribute("id",value.id);
                   cityEditId[i].classList.add("fireevent"+value.id);
                   citySaveId[i].classList.add("smokeevent"+value.id);
                   editCall(value.id,value.slab.id);
   
                   j=true;
                }
   
            });
   
            if(j==false)
            {
              city_extra_km[i].value = "";
              city_extra_hrs[i].value = "";
              document.getElementsByClassName("fgr")[i].value = "";
              cst[i].innerHTML = "";
              city_nightbatta[i].value = "";
              cityMargin[i].value = "";
              cityMargin[i].disabled=false;
              city_extra_km[i].disabled=false;
              city_extra_hrs[i].disabled=false;
              city_nightbatta[i].disabled=false;
              document.getElementsByClassName("fgr")[i].disabled=false;
              document.getElementsByClassName("vvid_result3")[i].innerHTML = "<input type='text' class='vvid_city ctags' name=''>";
            }
   
        }
        tagsLoad();
    });
   
   });
   
   $('#select_service1').on('click',function(){
   
   if($('#select_service1 option:selected').text()){
      $('.ast').text($('#select_service1 option:selected').text());
   }
   });
   
   $('#saveairport').click(function(){
   
      for(var i=0;i<cat_id.length;i++){
   
   var airport = {
      "created_by":{{user.id}},
      "city":parseInt($('#city_list option:selected').val()),
      "category":parseInt(cat_id[i].innerHTML),
      "service_type":parseInt($('#select_service1 option:selected').val()),
      "base_rate":base_rate[i].value?parseInt(base_rate[i].value):0,
      "vendor":{{vendor.id}},
      "vehicle_varient":vv_airname[i].value,
      "gst_no":vendor_gstno.value,
      "margin":airportMargin[i].value
   
   };
   
   console.log(airport);
   
         $.ajax({
            url: '/rapido/api/add_vendorairportratecard/',
            method: 'POST',
            headers:{'X-CSRFToken':'{{ csrf_token }}'},                  
            contentType : 'application/json',
            data: JSON.stringify(airport),
            success:function(res){
               
                        swal("Thank you!", "Airport Rate card has been set!", "success");
            }
         });
      }
   });
   
   //standard rate_card airport related end
   
   //standard rate_card outstation related
   
   $('#select_service2').on('click',function(){
   
   if($('#select_service2 option:selected').text()){
      $('.ost').text($('#select_service2 option:selected').text());
   }
   });
   
   
   $('#saveoutstation').click(function() {
   
       for (var i = 0; i < cat_id1.length; i++) {
   
          if(document.getElementsByClassName("otags")[i].value!=""){
           var outstation = {
               "min_km": minkm[i].value?parseInt(minkm[i].value):0,
               "perkm_rate": perkm[i].value?parseFloat(perkm[i].value):0,
               "extrakm_rate": extrakm[i].value?parseFloat(extrakm[i].value):0,
               "day_batta": day_bata[i].value?parseInt(day_bata[i].value):0,
               "night_batta": night_bata[i].value?parseInt(night_bata[i].value):0,
               "created_by": {{user.id}},
               "city": parseInt($('#city_list option:selected').val()),
               "category": parseInt(cat_id1[i].innerHTML),
               "vendor":{{vendor.id}},
               "service_type": parseInt($('#select_service2 option:selected').val()),
               "vehicle_varient": vv_otsname[i].value,
               "gst_no":vendor_gstno.value,
               "margin":outstationMargin[i].value
           };
   
   
   
           $.ajax({
               url: '/rapido/api/add_vendoroutstationratecard/',
               method: 'POST',
               headers: {
                   'X-CSRFToken': '{{ csrf_token }}'
               },
               contentType: 'application/json',
               data: JSON.stringify(outstation),
               success: function(res) {
   
                   swal("Thank you!", "Outstation Rate card has been set!", "success");
   
               }
            });
          } 
       }
   });
   
   //standard rate_card outstation related end
   
   //standard rate_card cityusage related
   
   
   $('#select_service3').on('click',function(){
   
   if($('#select_service3 option:selected').text()){
      $('.cst').text($('#select_service3 option:selected').text());
   }
   });
   
   //add extra slab
   
   $('#slab').change(function() {
    var spans = document.querySelectorAll('#thcount th');
   
    var colCount = 0;
   
    //count no. of columns in cityusage
    $('#thcount th').each(function() {
        colCount++;
    });
    //count no. of columns in cityusage end
   
    //avoid adding duplicate slabs
    var thpresent = false;
    for (var k = 0; k < colCount; k++) {
        if ($(this).find('option:selected').attr('id') == spans[k].className) {
            thpresent = true;
        }
    }
   
    if (thpresent == false) {
   
        var text2 = $("<th class='slab" + $(this).find('option:selected').val() + "'><div class='close' id='" + $(this).find('option:selected').val() + "'><i class='fa fa-close'></i></div>" + $(this).find('option:selected').text() + " " + $(this).find('option:selected').val() + "</th>");
        var text3 = $("<td class='slab_dat" + $(this).find('option:selected').val() + "'><input class='slabdata" + $(this).find('option:selected').val() + " " + "form-control' type='text'></td>");
   
        $('.addSlab').last().before(text2);
        $('.slab_data').before(text3);
   
        $('.close').click(function() {
            $(this).parent().remove();
            $('.slab_dat'+$(this).attr('id')).remove();
        });
    } else {
   
        alert("slab already added");
    }
    //avoid adding duplicate slabs end
   
   });
   
   //add extra slab end
   
   
   $('#savecityusage').click(function() {
   
   //for displaying success one time
   
   //for displaying success one time end
   
   //get slab options count
   var optioncount=0;
    $('#slab option').each(function() {
        optioncount++;
    });
   //get slab options count end
   
    var spans = document.querySelectorAll('#thcount th'); //array of head columns
    var colCount = 0;
   
    //count no. of columns in cityusage
    $('#thcount th').each(function() {
        colCount++; //print array of columns
    });
    //count no. of columns in cityusage end
   
   
    //avoid adding duplicate slabs
    var thpresent;
   
    for (var i = 0; i < cat_id1.length; i++) //6 times
    {
      //dynamically assign class for slabs
      var l;
   
      for(var m = 0;m <optioncount;m++) //8 times
      {
        var sample = document.querySelectorAll('#slab option');
        var slab_id = sample[m].value;
   
            for (var k = 0; k < colCount; k++) {
                if (('slab'+slab_id) == spans[k].className) {
                    thpresent = slab_id;
   
                if(document.getElementsByClassName("slabdata"+thpresent)[i].value!="")
                {
                    var cityusage = 
                    {
                    "bill_computationtype": "a",
                    "fgr": parseInt(document.getElementsByClassName("fgr")[i].value)?parseInt(document.getElementsByClassName("fgr")[i].value):0,
                    "base_rate": parseInt(document.getElementsByClassName("slabdata"+thpresent)[i].value)?parseInt(document.getElementsByClassName("slabdata"+thpresent)[i].value):0,
                    "extra_kmrate": parseFloat(document.getElementsByClassName("city_extra_km")[i].value)?parseFloat(document.getElementsByClassName("city_extra_km")[i].value):0,
                    "extra_hrrate": parseInt(document.getElementsByClassName("city_extra_hrs")[i].value)?parseInt(document.getElementsByClassName("city_extra_hrs")[i].value):0,
                    "night_batta": parseInt(document.getElementsByClassName("city_nightbatta")[i].value)?parseInt(document.getElementsByClassName("city_nightbatta")[i].value):0,
                    "created_by": {{user.id}},
                    "city": parseInt($('#city_list option:selected').val()),
                    "category":  parseInt(cat_id1[i].innerHTML),
                    "vendor":{{vendor.id}},
                    "service_type": parseInt($('#select_service3 option:selected').val()),
                    "slab": parseInt(thpresent),
                    "vehicle_varient":vv_cityname[i].value,
                    "gst_no":vendor_gstno.value,
                    "margin":cityMargin[i].value,
                     };    
        
                  $.ajax({
                      url: '/rapido/api/add_vendorcityratecard/',
                      method: 'POST',
                      headers: {
                          'X-CSRFToken': '{{ csrf_token }}'
                      },
                      contentType: 'application/json',
                      data: JSON.stringify(cityusage),
                      success: function(res) {
                        swal("Thank you!", "City Rate card has been set!", "success");
                      }
                  });        
                }
                }
            }    
      }
      //dynamically assign class for slabs end
    }
   });
   
   //standard rate_card cityusage related end
   
   //function for copying cities of large datas
   $(function(){
   
   var afromcity_id;
   var atocity_id;
   var ofromcity_id;
   var otocity_id;
   var cfromcity_id;
   var ctocity_id;
   
   $("#afromcity_id,#atocity_id").on("click change focus",function(){
   
   afromcity_id = parseInt($("#afromcity_id").find("option:selected").val());
   atocity_id = parseInt($("#atocity_id").find("option:selected").val());
   
   });
   
   $("#ofromcity_id,#otocity_id").on("click change focus",function(){
   
   ofromcity_id = parseInt($("#ofromcity_id").find("option:selected").val());
   otocity_id = parseInt($("#otocity_id").find("option:selected").val());
   
   });
   
   $("#cfromcity_id,#ctocity_id").on("click change focus",function(){
   
   cfromcity_id = parseInt($("#cfromcity_id").find("option:selected").val());
   ctocity_id = parseInt($("#ctocity_id").find("option:selected").val());
   
   });
   
   
   
   $("#airportCopy").click(function(){
   
                swal({
                  title:"Are sure you want to copy?",
                  icon:"warning",
                  buttons:["Cancel","Copy"]
                }).then((willDelete) => {
                      if (willDelete) {
                $.get('/rapido/copyairportprice/{{vendor.id}}/'+afromcity_id+'/'+atocity_id+'/',function(data){
              if(data){
                swal({
                  title:"Copied successfully",
                  icon:"success"
                });
              }
                });
                      } else {
                        console.log("hello");
                      }
                    });
   });
   
   
   $("#outstationCopy").click(function(){
   
                swal({
                  title:"Are sure you want to copy?",
                  icon:"warning",
                  buttons:["Cancel","Copy"]
                }).then((willDelete) => {
                      if (willDelete) {
                $.get('/rapido/copyoutstationprice/{{vendor.id}}/'+ofromcity_id+'/'+otocity_id+'/',function(data){
              if(data){
                swal({
                  title:"Copied successfully",
                  icon:"success"
                });
              }
                });
                      } else {
                        console.log("hello");
                      }
                    });
   });
   
   
   $("#cityCopy").click(function(){
   
                swal({
                  title:"Are sure you want to copy?",
                  icon:"warning",
                  buttons:["Cancel","Copy"]
                }).then((willDelete) => {
                      if (willDelete) {
                $.get('/rapido/copycityprice/{{vendor.id}}/'+cfromcity_id+'/'+ctocity_id+'/',function(data){
              if(data){
                swal({
                  title:"Copied successfully",
                  icon:"success"
                });
              }
                });
                      } else {
                        console.log("hello");
                      }
                    });
   });
   
   });
   
   
   //function for copying cities of large datas
   
</script>
{% endblock %}